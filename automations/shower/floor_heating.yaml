- alias: "Shower: start floor heating when shower starts"
  id: 818c0f02-8d9c-4859-bfc2-ecf54897bace
  trigger:
    - platform: numeric_state
      entity_id:
        - sensor.shower_derivative
      above: 50

  action:
    choose:
      - conditions:
          condition: state
          entity_id:
            - switch.laundry_room_channel_2
          state: "off"

        sequence:
          - service: notify.castle_log
            data:
              title: "Duschen"
              message: "N책gon har duschat, startar golvv채rmen (derivat: {{trigger.to_state.state}})"
          - service: switch.turn_on
            target:
              entity_id: switch.laundry_room_channel_2

- alias: "Shower: turn off floor heating"
  id: decdc5d9-5bd0-41ab-bf91-7e77a38e49b3
  mode: queued
  trigger:
    - platform: state
      entity_id:
        - switch.laundry_room_channel_2
      to: "on"
      for:
        minutes: &timeout 120

    - platform: state
      entity_id:
        - binary_sensor.motion_bathroom_upstairs_occupancy

    - platform: time_pattern
      minutes: "/5"

  action:
    choose:
      - conditions:
          condition: state
          entity_id:
            - switch.laundry_room_channel_2
          state: "on"
          for:
            minutes: *timeout

        sequence:
          - service: notify.castle_log
            data:
              title: "Duschen"
              message: "St채ngde av golvv채rmen nu efter 2 timmar"
          - service: switch.turn_off
            target:
              entity_id: switch.laundry_room_channel_2
